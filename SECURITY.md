# 보안 가이드

## 개요

이 문서는 Our Bung Play 앱의 보안 구현 사항과 모범 사례를 설명합니다.

## 구현된 보안 기능

### 1. Firestore 보안 규칙

- **인증 기반 접근 제어**: 모든 데이터 접근에 Firebase Authentication 필요
- **역할 기반 권한 관리**: 채널 관리자, 이벤트 주최자 등 역할별 권한 제어
- **데이터 유효성 검증**: 서버 측에서 데이터 형식 및 필수 필드 검증
- **개인정보 보호**: 사용자는 자신의 데이터만 접근 가능

### 2. 입력 검증 및 Sanitization

- **XSS 방지**: HTML 태그 및 스크립트 제거
- **SQL Injection 방지**: 위험한 SQL 패턴 필터링
- **입력 길이 제한**: 각 필드별 최대/최소 길이 제한
- **허용된 문자만 사용**: 한글, 영문, 숫자 및 기본 특수문자만 허용

### 3. 민감 정보 암호화

- **계좌 정보 암호화**: 계좌번호, 예금주명 등 민감 정보 암호화 저장
- **암호화 키 관리**: 디바이스별 고유 암호화 키 생성 및 관리
- **데이터 마스킹**: 로그 및 UI에서 민감 정보 마스킹 처리

### 4. 보안 감사 및 로깅

- **보안 이벤트 로깅**: 인증, 권한 위반, 데이터 접근 등 모든 보안 이벤트 기록
- **실시간 모니터링**: 의심스러운 활동 실시간 감지 및 알림
- **감사 추적**: 모든 중요 작업에 대한 완전한 감사 추적

### 5. 속도 제한 및 남용 방지

- **API 속도 제한**: 사용자별, 작업별 속도 제한 적용
- **실패 시도 추적**: 로그인 실패 등 반복적인 실패 시도 모니터링
- **계정 잠금**: 과도한 실패 시도 시 임시 계정 잠금

## 보안 설정

### Firestore 규칙 배포

```bash
# 보안 규칙 배포
./scripts/deploy_security.sh
```

### 암호화 키 관리

앱 최초 실행 시 자동으로 암호화 키가 생성되며, SharedPreferences에 안전하게 저장됩니다.

```dart
// 암호화 서비스 사용 예시
final encryptedData = EncryptionService.encryptSensitiveData(
  sensitiveInfo, 
  encryptionKey
);
```

### 입력 검증 사용

```dart
// 입력 검증 및 정제
final sanitizedInput = await SecurityMiddleware.validateAndSanitizeInput(
  input: userInput,
  fieldName: 'eventTitle',
  userId: currentUserId,
  minLength: 2,
  maxLength: 100,
);
```

## 보안 모니터링

### 보안 이벤트 확인

```dart
// 사용자별 보안 이벤트 조회
final securityEvents = await SecurityAudit.getUserSecurityEvents(
  userId: userId,
  limit: 50,
);
```

### 보안 메트릭 확인

```dart
// 보안 메트릭 조회
final metrics = SecurityMiddleware.getSecurityMetrics();
```

## 보안 모범 사례

### 개발자 가이드라인

1. **입력 검증**: 모든 사용자 입력에 대해 검증 및 정제 수행
2. **권한 확인**: 모든 중요 작업 전 권한 확인
3. **민감 정보 처리**: 민감 정보는 반드시 암호화하여 저장
4. **로깅**: 보안 관련 모든 이벤트 로깅
5. **에러 처리**: 보안 에러 발생 시 적절한 처리 및 로깅

### 사용자 가이드라인

1. **강력한 비밀번호**: 복잡하고 고유한 비밀번호 사용
2. **정기적인 로그아웃**: 공용 기기 사용 후 반드시 로그아웃
3. **의심스러운 활동 신고**: 비정상적인 활동 발견 시 즉시 신고
4. **앱 업데이트**: 최신 보안 패치가 포함된 앱 버전 사용

## 보안 설정 파일

### 주요 설정

- `lib/core/security/security_config.dart`: 보안 설정 상수
- `firestore.rules`: Firestore 보안 규칙
- `firestore.indexes.json`: Firestore 인덱스 설정

### 환경별 설정

개발, 스테이징, 프로덕션 환경별로 다른 보안 설정을 적용할 수 있습니다.

## 보안 업데이트

### 정기 검토 사항

1. **Firestore 규칙 검토**: 월 1회 보안 규칙 검토 및 업데이트
2. **암호화 키 순환**: 분기별 암호화 키 순환 고려
3. **보안 로그 분석**: 주간 보안 로그 분석 및 이상 징후 확인
4. **의존성 업데이트**: 보안 패치가 포함된 패키지 업데이트

### 보안 인시던트 대응

1. **즉시 대응**: 보안 인시던트 발견 시 즉시 대응팀 알림
2. **로그 수집**: 관련 보안 로그 및 증거 수집
3. **영향 분석**: 인시던트 영향 범위 분석
4. **복구 조치**: 적절한 복구 조치 수행
5. **사후 검토**: 인시던트 원인 분석 및 재발 방지 대책 수립

## 연락처

보안 관련 문의나 인시던트 신고:
- 이메일: security@ourbungplay.com
- 긴급 상황: 24시간 보안 핫라인

---

**중요**: 이 문서의 내용은 정기적으로 업데이트되며, 모든 개발팀원은 최신 보안 가이드라인을 숙지해야 합니다.